
## This YAML file is sparsely commented, with a focus on the parts relevant to multiple inputs
## See my_profiles/example/builds.yaml for more general comments

### INPUT SET 1: Everything running locally, from local starting files
# inputs:
#   aus: # local files specified...
#     metadata: "data/example_metadata_aus.tsv"
#     sequences: "data/example_sequences_aus.fasta"
#   worldwide:
#     metadata: "data/example_metadata_worldwide.tsv"
#     sequences: "data/example_sequences_worldwide.fasta"

### INPUT SET 2: Everything running locally, but downloading GISAID starting files
# inputs:
#   aus: # local files specified...
#     metadata: "data/example_metadata_aus.tsv"
#     sequences: "data/example_sequences_aus.fasta"
#   gisaid:
#     metadata: "s3://nextstrain-ncov-private/metadata.tsv.gz"
#     sequences: "s3://nextstrain-ncov-private/sequences.fasta.gz"

### INPUT SET 3: GISIAD starting files are using pre-computed filtered alignment
inputs:
  aus: # local files specified...
    metadata: "data/example_metadata_aus.tsv"
    sequences: "data/example_sequences_aus.fasta"
  gisaid:
    metadata: "s3://nextstrain-ncov-private/metadata.tsv.gz"
    filtered: "s3://nextstrain-ncov-private/filtered.fasta.xz"


builds:
  multiple-inputs:
    subsampling_scheme: custom-scheme # use a custom subsampling scheme defined below

subsampling:
  custom-scheme:
    # Use metadata key to include ALL from `input1`
    allFromAus:
      exclude: "--exclude-where 'aus=no'" # subset to sequences from input `aus`
      group_by: year # needed for pipeline to work!
      seq_per_group: 1000000 # needed for pipeline to work!
    # Proximity subsampling from `input2` to provide context 
    worldwideContext:
      exclude: "--exclude-where 'aus=yes'" # i.e. subset to sequences _not_ from input `aus`
      group_by: year month
      seq_per_group: 10
      priorities:
        type: "proximity"
        focus: "allFromAus"

files:
  auspice_config: "my_profiles/example_multiple_inputs/my_auspice_config.json"
  description: "my_profiles/example_multiple_inputs/my_description.md"

filter:
  aus:
    min_length: 5000 # Allow shorter genomes. Parameter used in the prefilter & filter rules
    exclude_where: country=Canada # Would remove all Canadian sequences (there aren't any!)
    min_date: "2020-02-01" # used by the filter rule. Will remove all sequences from Jan 2020
    exclude_ambiguous_dates_by: year # used by the filter rule.
    skip_diagnostics: True # skip diagnostics (which can remove genomes) for this input

skip_travel_history_adjustment: True

traits:
  multiple-inputs:
    sampling_bias_correction: 2.5
    columns: ["country"]